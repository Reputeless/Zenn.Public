---
title: "ゲームエンジンを自作する場合のテキスト描画機能を考える"
emoji: "🔠"
type: "tech"
topics: ["siv3d", "cpp"]
published: false
---

> [Siv3D Advent Calendar 2025](https://qiita.com/advent-calendar/2025/siv3d) および [グラフィックス全般 Advent Calendar 2025](https://qiita.com/advent-calendar/2025/graphics) の記事です。

ゲームエンジン・ライブラリを自作する場合に、テキスト描画に関してどのような機能を実装・提供すべきかを整理しました。

## 1. フォント管理
- フォントファイルの読み込みや形式サポートに関する機能

### 1.1 一般的なフォント形式の読み込み
- TrueType (.ttf) / OpenType (.otf) などのロードに対応する

### 1.2 フォントコレクション対応
- TTC/OTC など、1 ファイルに複数書体が含まれる形式に対応する

### 1.3 カラーフォント対応
- ビットマップやベクター (COLRv1 など) を含むカラーフォントに対応する

### 1.4 Variable Font 対応
- Variable Font の軸パラメータ（Weight, Widthなど）を動的に制御する

### 1.5 埋め込みビットマップ対応
- ベクターフォントに含まれるビットマップデータ（MS ゴシック等の EBDT）の利用有無を制御する

### 1.6 フォントメタデータ取得
- ファミリー名、バージョン、グリフ数などの基本情報を取得する

### 1.7 グリフ名取得
- フォントデータ内のグリフ名テーブルを参照し、グリフ名を取得する

### 1.8 デフォルトフォント内蔵
- プラットフォームに依存せず、共通の見た目のフォントを利用できるようにする
- Noto Sans, Noto Color Emoji, Material Design Icons など、標準的なフォントをエンジンに同梱・利用可能にする

### 1.9 フォールバックシステム
- 指定フォントに文字がない場合、自動的に別のフォントを参照する



## 2. ラスタライズ
- 文字をどのように描画用データに変換・保持するかの機能

### 2.1 ビットマップラスタライズ
- 一般的なピクセルベースでのグリフ生成

### 2.2 SDF / MSDF 生成
- 拡大縮小に強い Signed Distance Field (SDF) / Multi-channel SDF（MSDF）形式でのグリフ生成・描画

### 2.3 静的テクスチャアトラス
- ビルド時やロード時に、必要な文字一覧からアトラスを事前生成する

### 2.4 動的テクスチャアトラス
- 実行時に必要な文字を順次テクスチャに書き込み、キャッシュを管理する



## 3. レイアウト
- 文字をどこに、どのように配置するかを決定する機能

### 3.1 アンカー配置
- 座標の原点指定（左上、中央、右下など）による描画位置の制御

### 3.2 ベースライン配置
- ベースラインを基準とした配置制御

### 3.3 均等割付
- 指定した幅に合わせて文字間隔を調整し、行頭・行末を揃える

### 3.4 行間制御
- 行送りの倍率を調整する

### 3.5 字間制御
- 字間の調整

### 3.6 タブ制御
- タブ文字の幅設定およびタブ位置揃え

### 3.7 禁則処理・ハイフネーション
- 行頭・行末の禁止文字処理や、欧文の単語分割処理

### 3.8 自動改行
- 指定した矩形幅に合わせて自動的に折り返す

### 3.9 省略記号
- 矩形に入り切らない場合、末尾を「...」などで省略表示する

### 3.10 縦書き
- 日本語などの縦書きレイアウトと、縦書き用グリフの使用に対応する

### 3.11 RTL / BiDi 対応
- アラビア語などの右横書き (RTL) および、混在時の双方向テキスト (BiDi) アルゴリズム

### 3.12 合字制御
- fi や ff などの合字機能の On/Off 切り替え

### 3.13 ルビ表示
- 文字に対してルビを配置・レンダリングする

### 3.14 自然言語分割
- 日本語の文節など、意味のまとまりで改行候補を算出する
- BudouX などのライブラリを活用できる

### 3.15 テキスト領域計測
- 実際に描画を行わず、レイアウト後のバウンディングボックスサイズのみを取得する



## 4. 文字コード
- 文字データの扱いに関する基本機能

### 4.1 Unicode 完全対応
- サロゲートペアなどを正しく扱う

### 4.2 絵文字対応
- カラー絵文字や ZWJ シーケンス（家族の絵文字など合成されるもの）の正しい描画

### 4.3 アイコンフォント対応
- 私用領域 (PUA) などに割り当てられたアイコンフォントを正しく扱う

### 4.4 グリフ存在確認
- 指定した文字に対応するグリフがフォント内に存在するか確認する



## 5. 装飾
- 見た目を装飾する機能

### 5.1 擬似ボールド / イタリック
- フォントデータがない場合に、ジオメトリ操作で太字・斜体を再現する

### 5.2 頂点カラー
- 文字全体、または上下左右の頂点ごとの色指定

### 5.3 グラデーション
- 文字の上下方向、テキストの横方向などに沿ったグラデーション塗りつぶし

### 5.3 アウトライン
- 文字の輪郭線を描画する

### 5.4 ドロップシャドウ
- 文字の影を描画する

### 5.5 光彩
- 文字の外側に発光表現を加える

### 5.6 下線・取り消し線
- 文字の装飾線を描画する

### 5.7 インライン画像
- テキスト中に画像を埋め込む

### 5.8 カスタムシェーダー
- 標準の描画シェーダーをユーザー定義のものでオーバーライドする機能



## 6. アニメーション・変形
- ゲーム特有の動的な表現機能

### 6.1 タイプライター演出
- 1 文字ずつ時間をずらして表示する

### 6.2 文字単位アニメーション
- 個別の文字に対し、位置・回転・スケール・色を動的に操作する

### 6.3 鏡文字・反転
- 文字を左右・上下に反転して描画する

### 6.4 メッシュ変形
- 円形配置や波打ちなど、テキスト全体または文字単位でメッシュを変形させる

### 6.5 反射
- テキストの下部に鏡面反射のような描画を追加する



## 7. 発展的なデータアクセス
- レンダリング以外でのデータ利用

### 7.1 輪郭パス取得
- 文字の輪郭をベクターパスや座標配列として取得する

### 7.2 メッシュデータ取得
- グリフを構成する三角形ポリゴンを生成・取得する

### 7.3 ビットマップ書き出し
- グリフをビットマップ画像として取得・保存する



## 8. その他

### 8.1 バッチング
- 複数の文字をまとめて 1 回のドローコールで描画する

### 8.2 レイアウトキャッシュ
- 計算コストの高い文字配置結果をキャッシュし、再利用する

### 8.3 リッチテキスト
- HTML タグ風や Markdown 風のマークアップによる書式指定をパースし、スタイルを適用する

### 8.4 ミッシンググリフ
- グリフが見つからない場合に代わりの文字を表示する。.notdef (豆腐) を使うことが多い
